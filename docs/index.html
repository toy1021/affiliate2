<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>日本のテックニュース速報 | 毎時更新される最新IT情報</title>
    <meta name="description" content="AI・機械学習、Apple製品、プログラミングなど最新テクノロジーニュースを毎時自動更新。8つの主要IT情報源から厳選した記事と関連商品をお届け。SPA対応で快適なブラウジング体験を提供。">
    <meta name="keywords" content="テクノロジーニュース,AI,機械学習,Apple,iPhone,プログラミング,Python,JavaScript,IT速報,ガジェット,SPA,毎時更新,自動収集,RSS,アフィリエイト,Amazon,楽天">
    <meta name="author" content="日本のテックニュース速報">
    <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1,noarchive">
    <meta name="googlebot" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1">
    <meta name="bingbot" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1">
    <meta name="language" content="ja">
    <meta name="geo.region" content="JP">
    <meta name="geo.country" content="JP">
    <meta name="revisit-after" content="1 hour">
    <meta name="distribution" content="global">
    <meta name="rating" content="general">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta http-equiv="content-language" content="ja">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="format-detection" content="telephone=no">
    <meta name="theme-color" content="#2563eb">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="テックニュース速報">
    
    <!-- Enhanced SEO Meta Tags -->
    <meta name="news_keywords" content="AI,機械学習,Apple,iPhone,プログラミング,Python,JavaScript,テクノロジー,IT,ガジェット">
    <meta name="article:tag" content="テクノロジーニュース">
    <meta name="article:tag" content="IT業界">
    <meta name="article:tag" content="人工知能">
    <meta name="article:tag" content="Apple製品">
    <meta name="article:tag" content="プログラミング">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:title" content="日本のテックニュース速報 | 毎時更新される最新IT情報">
    <meta property="og:description" content="AI・機械学習、Apple製品、プログラミングなど最新テクノロジーニュースを毎時自動更新。関連商品も一緒にお届け。">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://toy1021.github.io/affiliate2/">
    <meta property="og:image" content="https://toy1021.github.io/affiliate2/favicon-192x192.png">
    <meta property="og:image:width" content="192">
    <meta property="og:image:height" content="192">
    <meta property="og:image:type" content="image/png">
    <meta property="og:site_name" content="日本のテックニュース速報">
    <meta property="og:locale" content="ja_JP">
    <meta property="article:publisher" content="https://github.com/toy1021/affiliate2">
    <meta property="article:author" content="日本のテックニュース速報">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="日本のテックニュース速報 | 毎時更新される最新IT情報">
    <meta name="twitter:description" content="AI・機械学習、Apple製品、プログラミングなど最新テクノロジーニュースを毎時自動更新。関連商品も一緒にお届け。">
    <meta name="twitter:image" content="https://toy1021.github.io/affiliate2/favicon-192x192.png">
    <meta name="twitter:image:alt" content="日本のテックニュース速報のロゴ - 最新テクノロジー情報をお届け">
    <meta name="twitter:site" content="@tech_news_jp">
    <meta name="twitter:creator" content="@tech_news_jp">
    
    <link rel="canonical" href="https://toy1021.github.io/affiliate2/">
    
    <!-- Performance optimization: Resource hints -->
    <link rel="dns-prefetch" href="//www.googletagmanager.com">
    <link rel="dns-prefetch" href="//pagead2.googlesyndication.com">
    <link rel="dns-prefetch" href="//www.amazon.co.jp">
    <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
    <link rel="preconnect" href="https://pagead2.googlesyndication.com" crossorigin>
    
    <!-- Critical resource preloading -->
    <link rel="preload" href="articles.json" as="fetch" crossorigin>
    <link rel="preload" href="sitemap.xml" as="fetch">
    <link rel="prefetch" href="performance.json">
    <link rel="prefetch" href="sitemap.json">
    
    <!-- Favicon with optimized loading -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="manifest" href="site.webmanifest">
    
    <!-- Google Analytics with performance optimization -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-C8010SR0ZW"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-C8010SR0ZW');
    </script>
    
    <!-- Google AdSense - deferred for performance -->
    <script>
        // Defer AdSense loading until page is idle
        function loadAdSense() {
            const script = document.createElement('script');
            script.async = true;
            script.src = 'https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7886055685797359';
            script.crossOrigin = 'anonymous';
            document.head.appendChild(script);
        }
        
        // Load AdSense after critical content is loaded
        if (window.requestIdleCallback) {
            requestIdleCallback(loadAdSense);
        } else {
            setTimeout(loadAdSense, 2000);
        }
    </script>
    
    <!-- 構造化データ（JSON-LD）- SPA対応 -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "NewsMediaOrganization",
      "name": "日本のテックニュース速報",
      "url": "https://toy1021.github.io/affiliate2/",
      "logo": {
        "@type": "ImageObject",
        "url": "https://toy1021.github.io/affiliate2/favicon-192x192.png",
        "width": 192,
        "height": 192
      },
      "sameAs": [
        "https://github.com/toy1021/affiliate2"
      ],
      "description": "最新のテクノロジーニュースと関連商品をお届け",
      "founder": {
        "@type": "Organization",
        "name": "日本のテックニュース速報"
      },
      "publishingPrinciples": "https://toy1021.github.io/affiliate2/",
      "contactPoint": {
        "@type": "ContactPoint",
        "contactType": "customer service",
        "availableLanguage": "Japanese"
      }
    }
    </script>

    <!-- WebSite構造化データ -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "日本のテックニュース速報",
      "url": "https://toy1021.github.io/affiliate2/",
      "description": "最新のテクノロジーニュースと関連商品をお届け",
      "inLanguage": "ja",
      "potentialAction": {
        "@type": "SearchAction",
        "target": {
          "@type": "EntryPoint",
          "urlTemplate": "https://toy1021.github.io/affiliate2/?q={search_term_string}"
        },
        "query-input": "required name=search_term_string"
      },
      "publisher": {
        "@type": "Organization",
        "name": "日本のテックニュース速報",
        "logo": {
          "@type": "ImageObject",
          "url": "https://toy1021.github.io/affiliate2/favicon-192x192.png"
        }
      }
    }
    </script>

    <!-- BreadcrumbList構造化データ -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "ホーム",
          "item": "https://toy1021.github.io/affiliate2/"
        }
      ]
    }
    </script>

    <!-- CollectionPage構造化データ - ニュース記事コレクション -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "CollectionPage",
      "name": "日本のテックニュース記事一覧",
      "description": "AI・機械学習、Apple製品、プログラミングなど最新テクノロジーニュースの記事一覧。毎時自動更新で最新情報をお届け。",
      "url": "https://toy1021.github.io/affiliate2/",
      "inLanguage": "ja",
      "isPartOf": {
        "@type": "WebSite",
        "name": "日本のテックニュース速報",
        "url": "https://toy1021.github.io/affiliate2/"
      },
      "mainContentOfPage": {
        "@type": "WebPageElement",
        "cssSelector": ".articles-grid"
      },
      "significantLink": [
        "https://toy1021.github.io/affiliate2/?category=AI・機械学習",
        "https://toy1021.github.io/affiliate2/?category=Apple製品",
        "https://toy1021.github.io/affiliate2/?category=プログラミング"
      ],
      "publisher": {
        "@type": "Organization",
        "name": "日本のテックニュース速報"
      }
    }
    </script>

    <!-- FAQPage構造化データ - よくある質問 -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "記事の更新頻度はどのくらいですか？",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "当サイトは毎時自動的に8つの主要IT情報源からRSSフィードを取得し、新しい記事が投稿されるとリアルタイムで更新されます。通常1時間に1回の頻度で更新チェックを行っています。"
          }
        },
        {
          "@type": "Question",
          "name": "どのような情報源から記事を取得していますか？",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "日本の主要テクノロジーメディア8サイトからRSSフィードを自動取得しています。AI・機械学習、Apple製品、プログラミング、Google・Android、セキュリティなど幅広いカテゴリの最新ニュースを収集しています。"
          }
        },
        {
          "@type": "Question",
          "name": "アフィリエイトリンクについて教えてください。",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "記事に関連する商品やサービスのAmazonアフィリエイトリンクを記事の内容に基づいて自動生成しています。これらのリンクは記事の理解を深めたり、実際に商品を試してみたいユーザーに便利な情報を提供するものです。"
          }
        }
      ]
    }
    </script>

    <!-- Organization構造化データ - 詳細情報 -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "日本のテックニュース速報",
      "alternateName": "Tech News Japan",
      "url": "https://toy1021.github.io/affiliate2/",
      "logo": {
        "@type": "ImageObject",
        "url": "https://toy1021.github.io/affiliate2/favicon-192x192.png",
        "width": 192,
        "height": 192
      },
      "description": "日本最大級のテクノロジーニュース自動収集・配信サービス。AI・機械学習、Apple製品、プログラミングなど最新IT情報を毎時自動更新でお届け。",
      "foundingDate": "2025",
      "areaServed": {
        "@type": "Country",
        "name": "Japan"
      },
      "serviceType": "ニュース配信サービス",
      "knowsAbout": [
        "人工知能",
        "機械学習",
        "Apple製品",
        "iPhone",
        "プログラミング",
        "JavaScript",
        "Python",
        "テクノロジーニュース",
        "IT業界動向",
        "ガジェット"
      ],
      "sameAs": [
        "https://github.com/toy1021/affiliate2"
      ],
      "contactPoint": {
        "@type": "ContactPoint",
        "contactType": "customer service",
        "availableLanguage": ["ja", "Japanese"],
        "areaServed": "JP"
      }
    }
    </script>
    
    <!-- Critical CSS inlined for immediate rendering -->
    <style>
        /* Critical above-the-fold styles */
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --border-color: #e5e7eb;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
        }
        
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: var(--bg-secondary);
            font-display: swap;
        }
        
        /* Critical header styles for immediate visibility */
        header {
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        h1 {
            font-size: 1.8rem;
            color: var(--primary-color);
            font-weight: 700;
        }
        
        /* Loading optimization - critical only */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Critical container styles */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }
    </style>
    
    <!-- Load non-critical CSS after page render for optimal performance -->
    <script>
        // Load non-critical styles after initial render
        function loadNonCriticalCSS() {
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = 'data:text/css;base64,' + btoa(`
                .container {
                    max-width: 1200px;
                    margin: 0 auto;
                    padding: 0 2rem;
                }
                
                .header-content {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                
                .subtitle {
                    color: var(--text-secondary);
                    font-size: 0.9rem;
                    margin-top: 0.2rem;
                }
                
                .update-info {
                    background: var(--bg-primary);
                    padding: 1.5rem;
                    border-radius: 8px;
                    margin: 2rem 0;
                    border: 1px solid var(--border-color);
                }
                
                .update-info p {
                    margin-bottom: 0.5rem;
                    font-size: 0.9rem;
                }
                
                .main-layout {
                    display: grid;
                    grid-template-columns: 1fr 300px;
                    gap: 2rem;
                    margin: 2rem 0;
                }
                
                .main-content {
                    min-width: 0;
                }
                
                .sidebar {
                    background: var(--bg-primary);
                    border: 1px solid var(--border-color);
                    border-radius: 8px;
                    padding: 1.5rem;
                    height: fit-content;
                    position: sticky;
                    top: 120px;
                }
                
                .sidebar h3 {
                    font-size: 1.1rem;
                    margin-bottom: 1rem;
                    color: var(--text-primary);
                    border-bottom: 2px solid var(--primary-color);
                    padding-bottom: 0.5rem;
                }
                
                .sidebar-menu {
                    list-style: none;
                    margin-bottom: 2rem;
                }
                
                .sidebar-menu li {
                    margin-bottom: 0.5rem;
                }
                
                .sidebar-menu a {
                    color: var(--text-secondary);
                    text-decoration: none;
                    display: block;
                    padding: 0.5rem 0.8rem;
                    border-radius: 4px;
                    transition: all 0.2s ease;
                    font-size: 0.9rem;
                }
                
                .sidebar-menu a:hover, .sidebar-menu a.active {
                    background: var(--bg-secondary);
                    color: var(--primary-color);
                }
                
                .source-count, .category-count {
                    color: var(--text-secondary);
                    font-size: 0.75rem;
                    margin-left: 0.3rem;
                }
                
                .articles-grid {
                    display: block;
                    margin: 2rem 0;
                }
                
                .article-card {
                    background: var(--bg-primary);
                    padding: 1.5rem;
                    border: 1px solid var(--border-color);
                    border-bottom: none;
                    transition: background-color 0.2s ease;
                }
                
                .article-card:first-child {
                    border-top-left-radius: 8px;
                    border-top-right-radius: 8px;
                }
                
                .article-card:last-child {
                    border-bottom: 1px solid var(--border-color);
                    border-bottom-left-radius: 8px;
                    border-bottom-right-radius: 8px;
                }
                
                .article-card:hover {
                    background: var(--bg-secondary);
                }
                
                .article-meta {
                    display: flex;
                    gap: 1rem;
                    align-items: center;
                    margin-bottom: 1rem;
                    color: var(--text-secondary);
                    font-size: 0.85rem;
                    flex-wrap: wrap;
                }
                
                .article-date {
                    color: var(--primary-color);
                    font-weight: 600;
                    font-size: 0.8rem;
                    background: rgba(37, 99, 235, 0.1);
                    padding: 0.2rem 0.5rem;
                    border-radius: 4px;
                }
                
                .article-source {
                    color: var(--text-secondary);
                    font-size: 0.8rem;
                }
                
                .category-tag {
                    background: var(--primary-color);
                    color: white;
                    padding: 0.3rem 0.8rem;
                    border-radius: 4px;
                    font-size: 0.8rem;
                    font-weight: 600;
                }
                
                .article-title {
                    font-size: 1.1rem;
                    margin-bottom: 0.8rem;
                    line-height: 1.4;
                }
                
                .article-title a {
                    color: var(--text-primary);
                    text-decoration: none;
                    transition: color 0.2s ease;
                }
                
                .article-title a:hover {
                    color: var(--primary-color);
                }
                
                .article-summary {
                    color: var(--text-secondary);
                    font-size: 0.9rem;
                    line-height: 1.5;
                    margin-bottom: 1rem;
                }
                
                .pagination {
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    gap: 1rem;
                    margin: 2rem 0;
                }
                
                .pagination-btn {
                    background: var(--bg-primary);
                    color: var(--primary-color);
                    padding: 0.7rem 1.2rem;
                    border: 1px solid var(--border-color);
                    border-radius: 6px;
                    text-decoration: none;
                    font-weight: 500;
                    transition: all 0.2s ease;
                }
                
                .pagination-btn:hover:not(.disabled) {
                    background: var(--primary-color);
                    color: white;
                }
                
                .pagination-btn.disabled {
                    opacity: 0.5;
                    cursor: not-allowed;
                }
                
                .pagination-btn.active {
                    background: var(--primary-color);
                    color: white;
                    font-weight: 600;
                }
                
                .pagination-info {
                    color: var(--text-secondary);
                    font-size: 0.9rem;
                }
                
                .filters {
                    display: flex;
                    gap: 1rem;
                    margin-bottom: 2rem;
                    align-items: center;
                    flex-wrap: wrap;
                }
                
                .filter-select {
                    padding: 0.5rem 1rem;
                    border: 1px solid var(--border-color);
                    border-radius: 6px;
                    background: var(--bg-primary);
                    font-size: 0.9rem;
                }
                
                .filter-select:focus {
                    outline: none;
                    border-color: var(--primary-color);
                }
                
                @media (max-width: 768px) {
                    .container {
                        padding: 0 1rem;
                    }
                    .main-layout {
                        grid-template-columns: 1fr;
                        gap: 1rem;
                    }
                    .sidebar {
                        position: static;
                        order: -1;
                    }
                    .article-card {
                        padding: 1rem;
                    }
                    .article-meta {
                        font-size: 0.8rem;
                    }
                    .pagination {
                        flex-direction: column;
                        gap: 0.8rem;
                    }
                }
                .hidden {
                    display: none;
                }
                .affiliate-links {
                    margin-top: 1rem;
                    padding-top: 1rem;
                    border-top: 1px solid var(--border-color);
                }
                .affiliate-links-compact {
                    display: flex;
                    gap: 0.5rem;
                    margin-bottom: 0.5rem;
                    flex-wrap: wrap;
                }
                .affiliate-link {
                    background: linear-gradient(135deg, #ff9500, #ff6b00);
                    color: white;
                    padding: 0.4rem 0.8rem;
                    border-radius: 6px;
                    text-decoration: none;
                    font-size: 0.8rem;
                    font-weight: 600;
                    transition: all 0.2s ease;
                    box-shadow: 0 2px 4px rgba(255, 149, 0, 0.2);
                }
                .affiliate-link:hover {
                    transform: translateY(-1px);
                    box-shadow: 0 4px 8px rgba(255, 149, 0, 0.3);
                }
                .amazon-link {
                    background: linear-gradient(135deg, #ff9500, #ff6b00);
                }
                .rakuten-link {
                    background: linear-gradient(135deg, #bf0000, #8b0000);
                }
            `);
            document.head.appendChild(link);
        }
        
        // Load non-critical CSS when browser is idle
        if (window.requestIdleCallback) {
            requestIdleCallback(loadNonCriticalCSS);
        } else {
            setTimeout(loadNonCriticalCSS, 1000);
        }
    </script>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div>
                    <h1>日本のテックニュース速報</h1>
                    <p class="subtitle">最新のテクノロジーニュースと関連商品をお届け</p>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="update-info" id="update-info">
            <div class="loading">
                <div class="spinner"></div>
            </div>
        </div>

        <div class="filters" id="filters" style="display: none;">
            <select class="filter-select" id="category-filter">
                <option value="">全カテゴリ</option>
            </select>
            <select class="filter-select" id="source-filter">
                <option value="">全ソース</option>
            </select>
        </div>

        <div class="main-layout">
            <div class="main-content">
                <div class="articles-grid" id="articles-container">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
                
                <div class="pagination" id="pagination" style="display: none;"></div>
            </div>
            
            <aside class="sidebar" id="sidebar" style="display: none;">
                <div class="category-list" id="categories">
                    <h3>カテゴリ</h3>
                    <ul class="sidebar-menu" id="category-menu"></ul>
                </div>
                
                <div class="pages-section">
                    <h3>ページ</h3>
                    <div class="pagination-info" id="page-info"></div>
                </div>
                
                <div class="affiliate-section" id="sources">
                    <h3>情報源</h3>
                    <ul class="sidebar-menu" id="sources-menu"></ul>
                </div>
            </aside>
        </div>
    </main>

    <script>
        // SPAアプリケーションのメインクラス
        class NewsApp {
            constructor() {
                this.data = null;
                this.currentPage = 1;
                this.articlesPerPage = 12;
                this.currentCategory = '';
                this.currentSource = '';
                this.filteredArticles = [];
                
                this.init();
            }
            
            async init() {
                try {
                    await this.loadData();
                    this.setupEventListeners();
                    this.setupRouter();
                    this.render();
                } catch (error) {
                    console.error('Error initializing app:', error);
                    this.showError('データの読み込みに失敗しました');
                }
            }
            
            async loadData() {
                const response = await fetch('articles.json');
                if (!response.ok) {
                    throw new Error('Failed to load articles');
                }
                this.data = await response.json();
                this.filteredArticles = this.data.articles;
                console.log('Data loaded:', this.data);
            }
            
            setupEventListeners() {
                // カテゴリフィルター
                document.getElementById('category-filter').addEventListener('change', (e) => {
                    this.currentCategory = e.target.value;
                    this.currentPage = 1;
                    this.filterArticles();
                    this.updateURL();
                    
                    // サイドバーの表示も更新
                    this.renderSidebar();
                });
                
                // ソースフィルター
                document.getElementById('source-filter').addEventListener('change', (e) => {
                    this.currentSource = e.target.value;
                    this.currentPage = 1;
                    this.filterArticles();
                    this.updateURL();
                });
                
                // サイドバーカテゴリクリック
                document.getElementById('category-menu').addEventListener('click', (e) => {
                    if (e.target.tagName === 'A') {
                        e.preventDefault();
                        const category = e.target.dataset.category || '';
                        this.currentCategory = category;
                        this.currentPage = 1;
                        this.filterArticles();
                        this.updateURL();
                        
                        // ドロップダウンフィルタも同期更新
                        document.getElementById('category-filter').value = category;
                    }
                });
            }
            
            setupRouter() {
                window.addEventListener('popstate', () => {
                    this.parseURL();
                });
                this.parseURL();
            }
            
            parseURL() {
                const url = new URL(window.location);
                this.currentPage = parseInt(url.searchParams.get('page')) || 1;
                this.currentCategory = url.searchParams.get('category') || '';
                this.currentSource = url.searchParams.get('source') || '';
                
                if (this.data) {
                    this.filterArticles();
                    // フィルタドロップダウンも更新
                    if (document.getElementById('category-filter')) {
                        document.getElementById('category-filter').value = this.currentCategory;
                    }
                    if (document.getElementById('source-filter')) {
                        document.getElementById('source-filter').value = this.currentSource;
                    }
                }
            }
            
            updateURL() {
                const url = new URL(window.location);
                url.searchParams.set('page', this.currentPage);
                
                if (this.currentCategory) {
                    url.searchParams.set('category', this.currentCategory);
                } else {
                    url.searchParams.delete('category');
                }
                
                if (this.currentSource) {
                    url.searchParams.set('source', this.currentSource);
                } else {
                    url.searchParams.delete('source');
                }
                
                history.pushState(null, '', url);
            }
            
            filterArticles() {
                this.filteredArticles = this.data.articles.filter(article => {
                    const categoryMatch = !this.currentCategory || article.category === this.currentCategory;
                    const sourceMatch = !this.currentSource || article.source_name === this.currentSource;
                    return categoryMatch && sourceMatch;
                });
                
                this.render();
            }
            
            render() {
                this.renderUpdateInfo();
                this.renderFilters();
                this.renderSidebar();
                this.renderArticles();
                this.renderPagination();
                
                // Show all elements
                document.getElementById('filters').style.display = 'flex';
                document.getElementById('sidebar').style.display = 'block';
            }
            
            renderUpdateInfo() {
                const updateInfo = document.getElementById('update-info');
                updateInfo.innerHTML = `
                    <p><strong>最終更新:</strong> ${this.data.meta.last_updated}</p>
                    <p>✨ 新しい記事が投稿されるとリアルタイムで自動更新されます</p>
                    <p><strong>RSS監視サイト:</strong> ${this.data.meta.total_feeds}サイト</p>
                    <p><strong>アフィリエイトリンク:</strong> ${this.data.meta.total_affiliate_links}件</p>
                    <p><strong>更新間隔:</strong> リアルタイム（新記事検知時）</p>
                `;
            }
            
            renderFilters() {
                // カテゴリフィルター
                const categoryFilter = document.getElementById('category-filter');
                categoryFilter.innerHTML = '<option value="">全カテゴリ</option>';
                this.data.categories.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat.name;
                    option.textContent = `${cat.name} (${cat.count})`;
                    if (cat.name === this.currentCategory) option.selected = true;
                    categoryFilter.appendChild(option);
                });
                
                // ソースフィルター
                const sourceFilter = document.getElementById('source-filter');
                sourceFilter.innerHTML = '<option value="">全ソース</option>';
                this.data.sources.forEach(source => {
                    const option = document.createElement('option');
                    option.value = source.name;
                    option.textContent = `${source.name} (${source.count})`;
                    if (source.name === this.currentSource) option.selected = true;
                    sourceFilter.appendChild(option);
                });
            }
            
            renderSidebar() {
                // カテゴリメニュー
                const categoryMenu = document.getElementById('category-menu');
                categoryMenu.innerHTML = '';
                
                // 「全カテゴリ」オプションを追加
                const allCategoriesLi = document.createElement('li');
                allCategoriesLi.innerHTML = `
                    <a href="#" data-category="" ${!this.currentCategory ? 'class="active"' : ''}>
                        全カテゴリ <span class="category-count">(${this.data.articles.length})</span>
                    </a>
                `;
                categoryMenu.appendChild(allCategoriesLi);
                
                // 各カテゴリオプション
                this.data.categories.forEach(cat => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <a href="#" data-category="${cat.name}" ${cat.name === this.currentCategory ? 'class="active"' : ''}>
                            ${cat.name} <span class="category-count">(${cat.count})</span>
                        </a>
                    `;
                    categoryMenu.appendChild(li);
                });
                
                // ソースメニュー
                const sourcesMenu = document.getElementById('sources-menu');
                sourcesMenu.innerHTML = '';
                this.data.sources.forEach(source => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <a href="${source.url}" target="_blank" rel="noopener">
                            ${source.name} <span class="source-count">(${source.count})</span>
                        </a>
                    `;
                    sourcesMenu.appendChild(li);
                });
                
                // ページ情報
                const totalPages = Math.ceil(this.filteredArticles.length / this.articlesPerPage);
                document.getElementById('page-info').innerHTML = `
                    ページ: ${this.currentPage} / ${totalPages} (全${this.filteredArticles.length}記事)
                `;
            }
            
            renderArticles() {
                const container = document.getElementById('articles-container');
                const startIndex = (this.currentPage - 1) * this.articlesPerPage;
                const endIndex = startIndex + this.articlesPerPage;
                const pageArticles = this.filteredArticles.slice(startIndex, endIndex);
                
                if (pageArticles.length === 0) {
                    container.innerHTML = '<p>該当する記事が見つかりません。</p>';
                    return;
                }
                
                container.innerHTML = pageArticles.map(article => `
                    <article class="article-card">
                        <div class="article-meta">
                            <span class="article-date">${article.published_relative}</span>
                            <span class="category-tag">${article.category}</span>
                            <span class="article-source">${article.source_name}</span>
                        </div>
                        
                        <h2 class="article-title">
                            <a href="${article.link || article.original_link}" target="_blank" rel="noopener">
                                ${article.title}
                            </a>
                        </h2>
                        
                        ${article.summary ? `<p class="article-summary">${article.summary}</p>` : ''}
                        
                        ${this.renderAffiliateLinks(article)}
                    </article>
                `).join('');
                
                // Generate structured data for articles
                this.generateArticleStructuredData(pageArticles);
            }
            
            generateArticleStructuredData(articles) {
                // Remove existing article structured data
                const existingStructuredData = document.querySelectorAll('script[data-article-structured-data]');
                existingStructuredData.forEach(script => script.remove());
                
                // Generate ItemList structured data for current page articles
                const itemListData = {
                    "@context": "https://schema.org",
                    "@type": "ItemList",
                    "name": "テックニュース記事一覧",
                    "description": `${this.currentCategory ? this.currentCategory + 'カテゴリの' : ''}最新テクノロジーニュース記事`,
                    "numberOfItems": articles.length,
                    "itemListElement": articles.map((article, index) => ({
                        "@type": "ListItem",
                        "position": index + 1,
                        "item": {
                            "@type": "Article",
                            "@id": article.link || article.original_link,
                            "headline": article.title,
                            "description": article.summary || article.title,
                            "url": article.link || article.original_link,
                            "datePublished": article.published_at,
                            "dateModified": article.published_at,
                            "author": {
                                "@type": "Organization",
                                "name": article.source_name
                            },
                            "publisher": {
                                "@type": "Organization",
                                "name": "日本のテックニュース速報",
                                "logo": {
                                    "@type": "ImageObject",
                                    "url": "https://toy1021.github.io/affiliate2/favicon-192x192.png"
                                }
                            },
                            "articleSection": article.category,
                            "keywords": [article.category, "テクノロジー", "ニュース", "IT"],
                            "mainEntityOfPage": {
                                "@type": "WebPage",
                                "@id": article.link || article.original_link
                            },
                            "isPartOf": {
                                "@type": "WebSite",
                                "name": "日本のテックニュース速報",
                                "url": "https://toy1021.github.io/affiliate2/"
                            }
                        }
                    }))
                };
                
                // Create and append the structured data script
                const script = document.createElement('script');
                script.type = 'application/ld+json';
                script.setAttribute('data-article-structured-data', 'true');
                script.textContent = JSON.stringify(itemListData, null, 2);
                document.head.appendChild(script);
            }
            
            renderAffiliateLinks(article) {
                if (!article.affiliate_links || !article.has_affiliate_links) {
                    return '';
                }
                
                let html = '<div class="affiliate-links">';
                
                if (article.affiliate_links.keyword_based && article.affiliate_links.keyword_based.length > 0) {
                    html += '<div class="affiliate-links-compact">';
                    article.affiliate_links.keyword_based.slice(0, 2).forEach(link => {
                        html += `<a href="${link.url}" class="affiliate-link ${link.platform}-link" target="_blank" rel="noopener sponsored">${link.display_text}</a>`;
                    });
                    html += '</div>';
                }
                
                if (article.affiliate_links.category_recommendations && article.affiliate_links.category_recommendations.length > 0) {
                    html += '<div class="affiliate-links-compact">';
                    article.affiliate_links.category_recommendations.slice(0, 1).forEach(link => {
                        html += `<a href="${link.url}" class="affiliate-link ${link.platform}-link" target="_blank" rel="noopener sponsored">${link.display_text}</a>`;
                    });
                    html += '</div>';
                }
                
                html += '</div>';
                return html;
            }
            
            renderPagination() {
                const pagination = document.getElementById('pagination');
                const totalPages = Math.ceil(this.filteredArticles.length / this.articlesPerPage);
                
                if (totalPages <= 1) {
                    pagination.style.display = 'none';
                    return;
                }
                
                pagination.style.display = 'flex';
                
                let html = '';
                
                // Previous button
                if (this.currentPage > 1) {
                    html += `<a href="#" class="pagination-btn" data-page="${this.currentPage - 1}">← 前</a>`;
                } else {
                    html += `<span class="pagination-btn disabled">← 前</span>`;
                }
                
                // Page numbers (show up to 5 pages around current page)
                const startPage = Math.max(1, this.currentPage - 2);
                const endPage = Math.min(totalPages, this.currentPage + 2);
                
                // First page if not in range
                if (startPage > 1) {
                    html += `<a href="#" class="pagination-btn" data-page="1">1</a>`;
                    if (startPage > 2) {
                        html += `<span class="pagination-btn disabled">...</span>`;
                    }
                }
                
                // Page numbers in range
                for (let i = startPage; i <= endPage; i++) {
                    if (i === this.currentPage) {
                        html += `<span class="pagination-btn active">${i}</span>`;
                    } else {
                        html += `<a href="#" class="pagination-btn" data-page="${i}">${i}</a>`;
                    }
                }
                
                // Last page if not in range
                if (endPage < totalPages) {
                    if (endPage < totalPages - 1) {
                        html += `<span class="pagination-btn disabled">...</span>`;
                    }
                    html += `<a href="#" class="pagination-btn" data-page="${totalPages}">${totalPages}</a>`;
                }
                
                // Next button
                if (this.currentPage < totalPages) {
                    html += `<a href="#" class="pagination-btn" data-page="${this.currentPage + 1}">次 →</a>`;
                } else {
                    html += `<span class="pagination-btn disabled">次 →</span>`;
                }
                
                pagination.innerHTML = html;
                
                // Add event listeners
                pagination.querySelectorAll('a[data-page]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.currentPage = parseInt(e.target.dataset.page);
                        this.updateURL();
                        this.renderArticles();
                        this.renderPagination();
                        this.renderSidebar();
                        window.scrollTo(0, 0);
                    });
                });
            }
            
            showError(message) {
                document.getElementById('articles-container').innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: var(--error-color);">
                        <p>${message}</p>
                    </div>
                `;
            }
        }
        
        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new NewsApp();
        });
        
        // Service Worker registration for improved performance (optional)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
        
        // Add keyboard shortcuts for better UX
        document.addEventListener('keydown', (e) => {
            // Alt + Home: Go to top
            if (e.altKey && e.key === 'Home') {
                window.scrollTo({top: 0, behavior: 'smooth'});
                e.preventDefault();
            }
            
            // Alt + R: Refresh data
            if (e.altKey && e.key === 'r') {
                location.reload();
                e.preventDefault();
            }
        });
        
        // Affiliate link styles are now loaded with non-critical CSS above
    </script>
</body>
</html>